<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
  />
  <title>Markerless AR with Gestures</title>

  <!-- A-Frame core -->
  <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
  <!-- AR hit-test -->
  <script src="https://unpkg.com/aframe-ar-hit-test-component@^1.0.0/dist/aframe-ar-hit-test-component.min.js"></script>
  <!-- Gesture detector & handler -->
  <script src="https://unpkg.com/aframe-gesture-detector@^1.0.0/dist/aframe-gesture-detector.min.js"></script>
  <script src="https://unpkg.com/aframe-gesture-handler@^1.0.0/dist/aframe-gesture-handler.min.js"></script>

  <style>
    body { margin: 0; overflow: hidden; }
    .loader {
      position: absolute; top:0; left:0;
      width:100%; height:100%;
      background: rgba(0,0,0,0.8);
      display: flex; align-items: center; justify-content: center;
      color: #fff; font-size: 1.2em; z-index: 9999;
    }
    .reminder {
      position: absolute; bottom: 20px; left:50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.7);
      color: #fff; padding: 10px 20px;
      border-radius: 4px; font-size: 0.9em;
      display: none; animation: flash 1s infinite;
      z-index: 10000;
    }
    @keyframes flash {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }
  </style>
</head>
<body>
  <div class="loader">Initializing ARâ€¦</div>
  <div class="reminder">Move your device to scan for surfaces</div>

  <a-scene
    embedded
    renderer="logarithmicDepthBuffer: true"
    xrweb
    webxr="optionalFeatures: hit-test; requiredFeatures: local-floor;"
    ar-hit-test="target: #reticle;"
    gesture-detector
    loading-screen="enabled: false"
  >
    <!-- Reticle that shows where you'll place the model -->
    <a-entity
      id="reticle"
      geometry="primitive: ring; radiusInner: 0.03; radiusOuter: 0.04;"
      material="shader: flat; opacity: 0.8;"
      position="0 0 0"
      visible="false"
    ></a-entity>

    <!-- Your GLB model, initially hidden -->
    <a-entity
      id="my-model"
      gltf-model="url(assets/SamIp_business_card.glb)"
      visible="false"
      scale="0.3 0.3 0.3"
      gesture-handler="enabled: true; rotate: true; scale: true;"
    ></a-entity>

    <!-- Camera -->
    <a-entity camera></a-entity>
  </a-scene>

  <script>
    const sceneEl = document.querySelector('a-scene');
    const loader = document.querySelector('.loader');
    const reminder = document.querySelector('.reminder');
    const reticle = document.querySelector('#reticle');
    const model = document.querySelector('#my-model');

    // Hide loader when A-Frame is ready
    sceneEl.addEventListener('loaded', () => {
      loader.style.display = 'none';
      reminder.style.display = 'block';
    });

    // When the hit-test reticle gets a valid surface
    sceneEl.addEventListener('reticlePlaced', (evt) => {
      reticle.object3D.position.copy(evt.detail.position);
      reticle.object3D.quaternion.copy(evt.detail.rotation);
      reticle.setAttribute('visible', true);
      reminder.style.display = 'none';
    });

    // If reticle disappears (no surface), show reminder
    sceneEl.addEventListener('hitLost', () => {
      reticle.setAttribute('visible', false);
      reminder.style.display = 'block';
    });

    // On user tap, place or move the model
    sceneEl.addEventListener('select', () => {
      const pos = reticle.object3D.position;
      const quat = reticle.object3D.quaternion;

      model.object3D.position.copy(pos);
      model.object3D.quaternion.copy(quat);
      model.setAttribute('visible', true);
    });
  </script>
</body>
</html>
